"use client";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import { useEffect, useRef } from "react";
import FAQ from "./faq/Faq";
import Mission from "./Mission";
import Lottie from "lottie-web";
import lottieRevealPoska from "@/data/lottie-revealPoska";

gsap.registerPlugin(ScrollTrigger);
gsap.config({
  nullTargetWarn: false,
});

const Work = () => {
  const titleRef = useRef<HTMLDivElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  const animPoskaRef = useRef<any>(null);
  const titleRef2 = useRef<SVGPathElement>(null);
  const titleRef3 = useRef<any>(null);

  useEffect(() => {
    if (containerRef.current) {
      const animPoska = Lottie.loadAnimation({
        container: containerRef.current,
        renderer: "svg",
        loop: false,
        autoplay: false,
        animationData: lottieRevealPoska, // Thay thế bằng dữ liệu animation của bạn
      });
      animPoskaRef.current = animPoska;

      ScrollTrigger.create({
        trigger: titleRef.current,
        start: "top top",
        end: "+=3000",
        scrub: true,
        pin: true,
        markers: true, // Hiển thị markers để debug
        onUpdate: (self) => {
          const progress = self.progress;
          const totalFrames = animPoska.totalFrames;
          const frame = Math.round(progress * totalFrames);
          animPoska.goToAndStop(frame, true);
          if (titleRef2.current && containerRef.current && containerRef.current.querySelector('path')) {
            titleRef2.current.setAttribute('d', containerRef.current.querySelector('path').getAttribute('d') as string);
          }
        },
      });

      return () => {
        animPoska.destroy();
        ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
      };
    }
  }, []);

  return (
    <section className="relative">
      <div ref={titleRef} className="works relative">
        <div className=" clippedDiv2">
        <div id="revealPoska" className="absolute"> <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 1920 1080" width="100%" height="100%" preserveAspectRatio="xMidYMid slice"> <defs> <clipPath id="poskaClipPath" clipPathUnits="objectBoundingBox" transform="scale(0.000625, 0.0011111111)"> <path ref={titleRef2} fill="#ffffff" transform="matrix(1,0,0,1,958,539)" clip-rule="nonzero" d="" fill-opacity="1"></path> </clipPath> </defs> </svg> </div>
        <FAQ />
      <div ref={containerRef} id="revealPoskaProxy" className="absolute">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1920 1080"
          width="1920"
          height="1080"
          preserveAspectRatio="xMidYMid meet"
        >
          <defs>
            <clipPath id="__lottie_element_2">
              <rect width="1920" height="1080" x="0" y="0"></rect>
            </clipPath>
            <mask id="__lottie_element_4">
              <path
              
                fill="#ffffff"
                clip-rule="nonzero"
                d=" M-383.5,-539.5 C-383.62701416015625,-539.2930297851562 -383.77301025390625,-539.0770263671875 -383.93499755859375,-538.85400390625 C-384.09698486328125,-538.6309814453125 -384.2749938964844,-538.4010009765625 -384.4670104980469,-538.1649780273438 C-384.65899658203125,-537.9290161132812 -384.8659973144531,-537.6859741210938 -385.0849914550781,-537.43798828125 C-385.3039855957031,-537.1900024414062 -385.53399658203125,-536.93701171875 -385.7749938964844,-536.677978515625 C-386.0159912109375,-536.4190063476562 -386.2669982910156,-536.155029296875 -386.5249938964844,-535.8880004882812 C-386.7829895019531,-535.6209716796875 -387.04901123046875,-535.3489990234375 -387.3210144042969,-535.0750122070312 C-387.5929870605469,-534.801025390625 -387.8710021972656,-534.5239868164062 -388.1520080566406,-534.2440185546875 C-388.4330139160156,-533.9639892578125 -388.7179870605469,-533.6820068359375 -389.0039978027344,-533.3980102539062 C-389.2900085449219,-533.114013671875 -389.5780029296875,-532.8289794921875 -389.864990234375,-532.5430297851562 C-390.1520080566406,-532.2570190429688 -390.43798828125,-531.969970703125 -390.72198486328125,-531.6840209960938 C-391.0060119628906,-531.3980102539062 -391.2860107421875,-531.1110229492188 -391.56201171875,-530.8259887695312 C-391.8380126953125,-530.541015625 -392.1090087890625,-530.2570190429688 -392.37298583984375,-529.9739990234375 C-392.6369934082031,-529.6909790039062 -392.89300537109375,-529.4099731445312 -393.1409912109375,-529.1320190429688 C-393.3890075683594,-528.85400390625 -393.62701416015625,-528.5780029296875 -393.85400390625,-528.3060302734375 C-394.08099365234375,-528.0339965820312 -394.2980041503906,-527.7650146484375 -394.5,-527.5 C-394.5400085449219,-527.447021484375 -394.5769958496094,-527.3920288085938 -394.6099853515625,-527.3350219726562 C-394.64300537109375,-527.2780151367188 -394.6730041503906,-527.218994140625 -394.70001220703125,-527.1580200195312 C-394.72698974609375,-527.0969848632812 -394.7510070800781,-527.0349731445312 -394.77301025390625,-526.9710083007812 C-394.7950134277344,-526.906982421875 -394.81500244140625,-526.8410034179688 -394.8330078125,-526.7739868164062 C-394.85101318359375,-526.7069702148438 -394.86700439453125,-526.6400146484375 -394.8819885253906,-526.5709838867188 C-394.8970031738281,-526.5020141601562 -394.9110107421875,-526.4320068359375 -394.92401123046875,-526.3610229492188 C-394.93701171875,-526.2899780273438 -394.95001220703125,-526.219970703125 -394.9620056152344,-526.1480102539062 C-394.9739990234375,-526.0759887695312 -394.98699951171875,-526.0050048828125 -395,-525.9329833984375 C-395.01300048828125,-525.8610229492188 -395.0249938964844,-525.7880249023438 -395.03900146484375,-525.7160034179688 C-395.0530090332031,-525.6439819335938 -395.0679931640625,-525.572021484375 -395.0840148925781,-525.5009765625 C-395.1000061035156,-525.4299926757812 -395.11700439453125,-525.3590087890625 -395.1369934082031,-525.2890014648438 C-395.1570129394531,-525.218994140625 -395.1780090332031,-525.1489868164062 -395.2019958496094,-525.0809936523438 C-395.22601318359375,-525.0130004882812 -395.25299072265625,-524.9450073242188 -395.2829895019531,-524.8790283203125 C-395.31298828125,-524.81298828125 -395.3450012207031,-524.7479858398438 -395.3810119628906,-524.6849975585938 C-395.4169921875,-524.6220092773438 -395.45599365234375,-524.5599975585938 -395.5,-524.5 C-395.57598876953125,-524.39599609375 -395.6549987792969,-524.2940063476562 -395.73699951171875,-524.1950073242188 C-395.8190002441406,-524.0960083007812 -395.90399169921875,-523.9990234375 -395.9909973144531,-523.905029296875 C-396.0780029296875,-523.8109741210938 -396.1659851074219,-523.718994140625 -396.2569885253906,-523.6279907226562 C-396.3479919433594,-523.5369873046875 -396.44000244140625,-523.447998046875 -396.53399658203125,-523.3610229492188 C-396.62799072265625,-523.2739868164062 -396.7229919433594,-523.18798828125 -396.8190002441406,-523.10302734375 C-396.9150085449219,-523.0180053710938 -397.01300048828125,-522.9340209960938 -397.1099853515625,-522.8510131835938 C-397.2070007324219,-522.7680053710938 -397.3039855957031,-522.6849975585938 -397.4020080566406,-522.60302734375 C-397.5,-522.52099609375 -397.59698486328125,-522.4390258789062 -397.6940002441406,-522.3569946289062 C-397.7909851074219,-522.2750244140625 -397.8869934082031,-522.1920166015625 -397.9830017089844,-522.1099853515625 C-398.0790100097656,-522.0280151367188 -398.17401123046875,-521.9450073242188 -398.2669982910156,-521.8610229492188 C-398.3599853515625,-521.7769775390625 -398.45098876953125,-521.6929931640625 -398.5409851074219,-521.6069946289062 C-398.6310119628906,-521.52099609375 -398.718994140625,-521.4349975585938 -398.80499267578125,-521.3469848632812 C-398.8909912109375,-521.2589721679688 -398.9729919433594,-521.1690063476562 -399.0539855957031,-521.0770263671875 C-399.135009765625,-520.9849853515625 -399.2130126953125,-520.8909912109375 -399.2869873046875,-520.7949829101562 C-399.3609924316406,-520.698974609375 -399.4320068359375,-520.6010131835938 -399.5,-520.5 C-399.57501220703125,-520.3880004882812 -399.64898681640625,-520.27197265625 -399.72198486328125,-520.1519775390625 C-399.7950134277344,-520.031982421875 -399.8659973144531,-519.9089965820312 -399.9360046386719,-519.7830200195312 C-400.0060119628906,-519.656982421875 -400.07501220703125,-519.5289916992188 -400.14300537109375,-519.3980102539062 C-400.21099853515625,-519.2670288085938 -400.27899169921875,-519.1329956054688 -400.3450012207031,-518.9979858398438 C-400.4110107421875,-518.8629760742188 -400.47698974609375,-518.7260131835938 -400.5419921875,-518.5869750976562 C-400.60699462890625,-518.447998046875 -400.6719970703125,-518.3090209960938 -400.7359924316406,-518.1680297851562 C-400.79998779296875,-518.0269775390625 -400.864013671875,-517.885009765625 -400.9280090332031,-517.7429809570312 C-400.99200439453125,-517.6010131835938 -401.05499267578125,-517.4580078125 -401.1180114746094,-517.3150024414062 C-401.1809997558594,-517.1719970703125 -401.2449951171875,-517.031005859375 -401.3080139160156,-516.8889770507812 C-401.3710021972656,-516.7470092773438 -401.4339904785156,-516.60498046875 -401.49798583984375,-516.4650268554688 C-401.56201171875,-516.3250122070312 -401.6260070800781,-516.1859741210938 -401.6910095214844,-516.0479736328125 C-401.7560119628906,-515.9099731445312 -401.82000732421875,-515.7739868164062 -401.885986328125,-515.6400146484375 C-401.9519958496094,-515.5059814453125 -402.01800537109375,-515.3740234375 -402.0849914550781,-515.2440185546875 C-402.1520080566406,-515.114013671875 -402.22100830078125,-514.9869995117188 -402.2900085449219,-514.8629760742188 C-402.3590087890625,-514.739013671875 -402.4289855957031,-514.6179809570312 -402.5,-514.5 C-403.4339904785156,-512.958984375 -404.3599853515625,-511.3380126953125 -405.27099609375,-509.6449890136719 C-406.1820068359375,-507.9519958496094 -407.0799865722656,-506.1860046386719 -407.9540100097656,-504.3529968261719 C-408.8280029296875,-502.5199890136719 -409.67999267578125,-500.62200927734375 -410.5010070800781,-498.6629943847656 C-411.3219909667969,-496.7040100097656 -412.114013671875,-494.68499755859375 -412.86700439453125,-492.6130065917969 C-413.6199951171875,-490.5409851074219 -414.33599853515625,-488.4159851074219 -415.0060119628906,-486.2439880371094 C-415.6759948730469,-484.0719909667969 -416.3009948730469,-481.8529968261719 -416.87200927734375,-479.593994140625 C-417.4429931640625,-477.3349914550781 -417.9620056152344,-475.0350036621094 -418.41900634765625,-472.7019958496094 C-418.8760070800781,-470.3689880371094 -419.27301025390625,-468.0010070800781 -419.60101318359375,-465.60699462890625 C-419.9289855957031,-463.2130126953125 -420.1889953613281,-460.7909851074219 -420.37298583984375,-458.3489990234375 C-420.5570068359375,-455.9070129394531 -420.66400146484375,-453.4440002441406 -420.68798828125,-450.9670104980469 C-420.7120056152344,-448.489990234375 -420.6510009765625,-445.9989929199219 -420.5,-443.5 C-420.3429870605469,-440.90899658203125 -420.10198974609375,-438.33599853515625 -419.781005859375,-435.7850036621094 C-419.4599914550781,-433.2340087890625 -419.0610046386719,-430.7070007324219 -418.5889892578125,-428.2080078125 C-418.11700439453125,-425.7090148925781 -417.5710144042969,-423.2380065917969 -416.9590148925781,-420.8009948730469 C-416.34698486328125,-418.364013671875 -415.6679992675781,-415.9630126953125 -414.9280090332031,-413.6000061035156 C-414.18798828125,-411.23699951171875 -413.3869934082031,-408.9129943847656 -412.531005859375,-406.635009765625 C-411.67498779296875,-404.35699462890625 -410.7640075683594,-402.1239929199219 -409.8039855957031,-399.9419860839844 C-408.843994140625,-397.760009765625 -407.8340148925781,-395.62701416015625 -406.781005859375,-393.552001953125 C-405.7279968261719,-391.47698974609375 -404.63299560546875,-389.4570007324219 -403.5,-387.5 C-403.3949890136719,-387.3190002441406 -403.28399658203125,-387.1440124511719 -403.1679992675781,-386.9739990234375 C-403.052001953125,-386.8039855957031 -402.9309997558594,-386.63800048828125 -402.8059997558594,-386.4750061035156 C-402.6809997558594,-386.31201171875 -402.552001953125,-386.1510009765625 -402.4219970703125,-385.99200439453125 C-402.2919921875,-385.8330078125 -402.1600036621094,-385.67498779296875 -402.0270080566406,-385.5169982910156 C-401.8940124511719,-385.3590087890625 -401.760986328125,-385.20098876953125 -401.62799072265625,-385.0400085449219 C-401.4949951171875,-384.8789978027344 -401.3630065917969,-384.7170104980469 -401.2340087890625,-384.5509948730469 C-401.1050109863281,-384.385009765625 -400.9779968261719,-384.21600341796875 -400.8550109863281,-384.0409851074219 C-400.73199462890625,-383.8659973144531 -400.614013671875,-383.6860046386719 -400.5,-383.5 C-400.4010009765625,-383.3380126953125 -400.30999755859375,-383.1600036621094 -400.2250061035156,-382.968994140625 C-400.1400146484375,-382.77801513671875 -400.05999755859375,-382.5740051269531 -399.9840087890625,-382.3609924316406 C-399.9079895019531,-382.14801025390625 -399.8340148925781,-381.927001953125 -399.7619934082031,-381.70098876953125 C-399.69000244140625,-381.4750061035156 -399.6199951171875,-381.2449951171875 -399.5480041503906,-381.0150146484375 C-399.47601318359375,-380.7850036621094 -399.40301513671875,-380.5539855957031 -399.3269958496094,-380.3269958496094 C-399.2510070800781,-380.1000061035156 -399.1719970703125,-379.87701416015625 -399.0880126953125,-379.6619873046875 C-399.0039978027344,-379.4469909667969 -398.9129943847656,-379.239990234375 -398.8160095214844,-379.0450134277344 C-398.718994140625,-378.8500061035156 -398.614013671875,-378.6669921875 -398.5,-378.5 C-398.3840026855469,-378.33099365234375 -398.25201416015625,-378.1629943847656 -398.10699462890625,-377.99798583984375 C-397.9620056152344,-377.8330078125 -397.80499267578125,-377.6700134277344 -397.6390075683594,-377.50799560546875 C-397.4729919433594,-377.34600830078125 -397.2980041503906,-377.1830139160156 -397.1180114746094,-377.0220031738281 C-396.93798828125,-376.8609924316406 -396.75299072265625,-376.6990051269531 -396.5669860839844,-376.5369873046875 C-396.3810119628906,-376.375 -396.1929931640625,-376.2120056152344 -396.00799560546875,-376.0469970703125 C-395.822998046875,-375.8819885253906 -395.6390075683594,-375.7170104980469 -395.4620056152344,-375.5480041503906 C-395.2850036621094,-375.3789978027344 -395.114013671875,-375.2080078125 -394.9519958496094,-375.03399658203125 C-394.7900085449219,-374.8599853515625 -394.6390075683594,-374.6820068359375 -394.5,-374.5 C-392.2430114746094,-371.5379943847656 -389.7909851074219,-368.5989990234375 -387.1520080566406,-365.71600341796875 C-384.51300048828125,-362.8330078125 -381.68701171875,-360.00799560546875 -378.67999267578125,-357.27398681640625 C-375.6730041503906,-354.5400085449219 -372.4849853515625,-351.89898681640625 -369.12298583984375,-349.3840026855469 C-365.760986328125,-346.8689880371094 -362.22601318359375,-344.4800109863281 -358.52301025390625,-342.25299072265625 C-354.82000732421875,-340.0260009765625 -350.95001220703125,-337.9599914550781 -346.9200134277344,-336.09100341796875 C-342.8900146484375,-334.22198486328125 -338.6990051269531,-332.5480041503906 -334.3550109863281,-331.1059875488281 C-330.010986328125,-329.66400146484375 -325.51300048828125,-328.4519958496094 -320.8680114746094,-327.5060119628906 C-316.2229919433594,-326.55999755859375 -311.4320068359375,-325.8800048828125 -306.5,-325.5 C-301.8609924316406,-325.14300537109375 -297.302001953125,-325.031005859375 -292.83099365234375,-325.1449890136719 C-288.3599853515625,-325.2590026855469 -283.9779968261719,-325.6000061035156 -279.6910095214844,-326.14898681640625 C-275.40399169921875,-326.697998046875 -271.2139892578125,-327.4549865722656 -267.1260070800781,-328.4020080566406 C-263.0379943847656,-329.3489990234375 -259.0539855957031,-330.4849853515625 -255.17999267578125,-331.7919921875 C-251.30599975585938,-333.0989990234375 -247.54299926757812,-334.5769958496094 -243.8990020751953,-336.2080078125 C-240.2550048828125,-337.8389892578125 -236.72799682617188,-339.62200927734375 -233.3280029296875,-341.53900146484375 C-229.92799377441406,-343.45599365234375 -226.6540069580078,-345.50799560546875 -223.51300048828125,-347.67401123046875 C-220.3719940185547,-349.8399963378906 -217.36599731445312,-352.1210021972656 -214.5,-354.5 C-211.57899475097656,-356.92401123046875 -208.71800231933594,-359.510986328125 -205.94000244140625,-362.2590026855469 C-203.16200256347656,-365.0069885253906 -200.4669952392578,-367.9159851074219 -197.8820037841797,-370.9809875488281 C-195.2969970703125,-374.0459899902344 -192.82000732421875,-377.2690124511719 -190.4770050048828,-380.64599609375 C-188.13400268554688,-384.02301025390625 -185.9250030517578,-387.5539855957031 -183.875,-391.23699951171875 C-181.8249969482422,-394.9200134277344 -179.93299865722656,-398.7550048828125 -178.2259979248047,-402.73699951171875 C-176.5189971923828,-406.718994140625 -174.99600219726562,-410.8500061035156 -173.68099975585938,-415.1260070800781 C-172.36599731445312,-419.4020080566406 -171.26100158691406,-423.822998046875 -170.38900756835938,-428.385986328125 C-169.51699829101562,-432.9490051269531 -168.87899780273438,-437.6549987792969 -168.5,-442.5 C-168.2969970703125,-445.093994140625 -168.19200134277344,-447.6650085449219 -168.177001953125,-450.21099853515625 C-168.16200256347656,-452.7569885253906 -168.23599243164062,-455.27801513671875 -168.39300537109375,-457.77398681640625 C-168.5500030517578,-460.2699890136719 -168.7899932861328,-462.739990234375 -169.10499572753906,-465.1809997558594 C-169.4199981689453,-467.62200927734375 -169.8090057373047,-470.0350036621094 -170.26600646972656,-472.41900634765625 C-170.72300720214844,-474.8030090332031 -171.2480010986328,-477.1579895019531 -171.83200073242188,-479.4809875488281 C-172.41600036621094,-481.8039855957031 -173.05999755859375,-484.09600830078125 -173.75599670410156,-486.3550109863281 C-174.45199584960938,-488.614013671875 -175.2010040283203,-490.8399963378906 -175.99400329589844,-493.031005859375 C-176.78700256347656,-495.22198486328125 -177.625,-497.3789978027344 -178.5,-499.5 C-179.26100158691406,-501.3429870605469 -180.06500244140625,-503.1659851074219 -180.91299438476562,-504.9670104980469 C-181.76100158691406,-506.76800537109375 -182.6510009765625,-508.5469970703125 -183.58299255371094,-510.30499267578125 C-184.51499938964844,-512.06298828125 -185.48699951171875,-513.7990112304688 -186.5,-515.5130004882812 C-187.51300048828125,-517.2269897460938 -188.5659942626953,-518.9190063476562 -189.65699768066406,-520.5880126953125 C-190.7480010986328,-522.2570190429688 -191.8780059814453,-523.9039916992188 -193.04400634765625,-525.5269775390625 C-194.2100067138672,-527.1500244140625 -195.41400146484375,-528.75 -196.6529998779297,-530.3270263671875 C-197.89199829101562,-531.9039916992188 -199.16600036621094,-533.4569702148438 -200.4739990234375,-534.9860229492188 C-201.78199768066406,-536.5150146484375 -203.125,-538.0189819335938 -204.5,-539.5 C-211.95799255371094,-539.5 -219.41700744628906,-539.5 -226.875,-539.5 C-234.33299255371094,-539.5 -241.79200744628906,-539.5 -249.25,-539.5 C-256.7080078125,-539.5 -264.1669921875,-539.5 -271.625,-539.5 C-279.0830078125,-539.5 -286.5419921875,-539.5 -294,-539.5 C-301.4580078125,-539.5 -308.9169921875,-539.5 -316.375,-539.5 C-323.8330078125,-539.5 -331.2919921875,-539.5 -338.75,-539.5 C-346.2080078125,-539.5 -353.6669921875,-539.5 -361.125,-539.5 C-368.5830078125,-539.5 -376.0419921875,-539.5 -383.5,-539.5"
                fill-opacity="0"
              ></path>
            </mask>
          </defs>
          <g clip-path="url(#__lottie_element_2)">
            <g
              mask="url(#__lottie_element_4)"
              transform="matrix(1,0,0,1,960,540)"
              opacity="1"
            >
              <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                <path
                  fill="rgb(0,0,0)"
                  fill-opacity="1"
                  d=" M960,540 C960,540 -960,540 -960,540 C-960,540 -960,-540 -960,-540 C-960,-540 960,-540 960,-540 C960,-540 960,540 960,540z"
                ></path>
              </g>
            </g>
          </g>
        </svg>
      </div>
      </div>
      </div>
    </section>
  );
};

export default Work;
